<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recept&#246;vers&#228;ttaren</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    body { margin: 0; background: #f5f0e8; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @media print { button { display: none !important; } }
  </style>
</head>
<body>
<div id="root"></div>
<script>
// â”€â”€ Shorthand â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const h = React.createElement;
const { useState, useEffect, useRef } = React;

// â”€â”€ PDF generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pdfEncode(s) {
  return String(s||"").replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")
    .split("").map(c=>{const n=c.charCodeAt(0);if(n<32)return" ";if(n>255)return"?";if(n>127)return"\\"+n.toString(8).padStart(3,"0");return c;}).join("");
}
function wrapText(text,fontSize){
  const max=Math.floor(495/(fontSize*0.55));
  const words=String(text||"").split(/\s+/).filter(Boolean);
  const lines=[];let line="";
  for(const w of words){const t=line?line+" "+w:w;if(t.length>max&&line){lines.push(line);line=w;}else line=t;}
  if(line)lines.push(line);return lines.length?lines:[""];
}
function generatePDF(recipe){
  const PW=595,PH=842,M=55;const items=[];
  const add=(text,size,bold,color,indent,spaceBefore)=>items.push({text:text||"",size:size||11,bold:!!bold,color:color||[30,30,30],indent:indent||0,spaceBefore:spaceBefore||0});
  add(recipe.titel||"Recept",20,true,[45,74,62],0,0);
  if(recipe.beskrivning)add(recipe.beskrivning,10,false,[107,98,88],0,8);
  const mt=recipe.meta||{};
  const ms=[mt.portioner,mt.totaltid&&"Totalt: "+mt.totaltid,mt.svarighetsgrad].filter(Boolean).join("   |   ");
  if(ms)add(ms,9,false,[130,120,110],0,6);
  add("",8);add("Ingredienser",13,true,[184,92,56],0,4);
  let lg="";
  for(const ing of(recipe.ingredienser||[])){
    if(ing.grupp&&ing.grupp!==lg){add(ing.grupp.toUpperCase(),8,true,[107,98,88],0,8);lg=ing.grupp;}
    add("- "+(ing.mangd?ing.mangd+"   ":"")+(ing.ingrediens||""),10,false,[30,30,30],8,0);
  }
  add("",8);add("Gor sa har",13,true,[184,92,56],0,4);
  (recipe.steg||[]).forEach((s,i)=>add((i+1)+".  "+s,10,false,[30,30,30],8,4));
  if(recipe.noteringar){add("",8);add("Tips",11,true,[184,92,56],0,0);add(recipe.noteringar,10,false,[107,98,88],8,4);}
  const allOps=[];let pi=0,y=PH-M;
  for(const item of items){y-=item.spaceBefore;if(y<M){pi++;y=PH-M;}if(!item.text)continue;
    for(const line of wrapText(item.text,item.size)){const lh=item.size*1.5;if(y-lh<M){pi++;y=PH-M;}
      const col=item.color;allOps.push({pi,x:M+item.indent,y,text:pdfEncode(line),size:item.size,bold:item.bold,r:col[0],g:col[1],b:col[2]});y-=lh;}}
  const numPages=pi+1;
  const streams=Array.from({length:numPages},(_,p)=>allOps.filter(op=>op.pi===p).map(op=>{
    const r=(op.r/255).toFixed(3),g=(op.g/255).toFixed(3),b=(op.b/255).toFixed(3);
    return r+" "+g+" "+b+" rg\nBT\n/"+(op.bold?"F2":"F1")+" "+op.size+" Tf\n"+op.x+" "+op.y+" Td\n("+op.text+") Tj\nET\n";
  }).join(""));
  const pageRefs=Array.from({length:numPages},(_,p)=>(5+p*2)+" 0 R").join(" ");
  const objs={};
  objs[1]="<< /Type /Catalog /Pages 2 0 R >>";
  objs[2]="<< /Type /Pages /Kids ["+pageRefs+"] /Count "+numPages+" >>";
  objs[3]="<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica /Encoding /WinAnsiEncoding >>";
  objs[4]="<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica-Bold /Encoding /WinAnsiEncoding >>";
  for(let p=0;p<numPages;p++){
    objs[5+p*2]="<< /Type /Page /Parent 2 0 R /MediaBox [0 0 "+PW+" "+PH+"]\n/Contents "+(6+p*2)+" 0 R\n/Resources << /Font << /F1 3 0 R /F2 4 0 R >> >> >>";
    objs[6+p*2]="<< /Length "+streams[p].length+" >>\nstream\n"+streams[p]+"\nendstream";}
  const totalObjs=5+numPages*2;let pdf="%PDF-1.4\n";const offsets={};
  for(let i=1;i<totalObjs;i++){offsets[i]=pdf.length;pdf+=i+" 0 obj\n"+objs[i]+"\nendobj\n";}
  const xrefAt=pdf.length;pdf+="xref\n0 "+totalObjs+"\n0000000000 65535 f \n";
  for(let i=1;i<totalObjs;i++)pdf+=String(offsets[i]).padStart(10,"0")+" 00000 n \n";
  pdf+="trailer\n<< /Size "+totalObjs+" /Root 1 0 R >>\nstartxref\n"+xrefAt+"\n%%EOF";
  const blob=new Blob([pdf],{type:"application/pdf"});const burl=URL.createObjectURL(blob);
  const a=document.createElement("a");a.href=burl;
  a.download=(recipe.titel||"recept").replace(/[^a-z0-9]/gi,"-").toLowerCase()+".pdf";
  document.body.appendChild(a);a.click();document.body.removeChild(a);
  setTimeout(()=>URL.revokeObjectURL(burl),1000);
}

// â”€â”€ API call â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function callBackend(payload){
  const res=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
  const data=await res.json();
  if(!data.ok)throw new Error(data.error||"Serverfel "+res.status);
  return data.recipe;
}

function buildPlainText(result,srcUrl){
  const m=result.meta||{};
  let t=(result.titel||"")+"\n";
  if(result.beskrivning)t+=result.beskrivning+"\n";
  [m.portioner,m.totaltid,m.svarighetsgrad].filter(Boolean).forEach(v=>t+=v+"   ");
  t+="\n\nINGREDIENSER\n";let lg="";
  for(const i of(result.ingredienser||[])){
    if(i.grupp&&i.grupp!==lg){t+="\n"+i.grupp.toUpperCase()+"\n";lg=i.grupp;}
    t+="- "+(i.mangd?i.mangd+"  ":"")+(i.ingrediens||"")+"\n";
  }
  t+="\nGÃ–R SÃ… HÃ„R\n";
  (result.steg||[]).forEach((s,i)=>{t+=(i+1)+". "+s+"\n";});
  if(result.noteringar)t+="\nTIPS\n"+result.noteringar;
  if(srcUrl)t+="\n\nKÃ¤lla: "+srcUrl;
  return t.trim();
}

// â”€â”€ Colors & constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const F="#2d4a3e",T="#b85c38",G="#c9a84c",CR="#f5f0e8",PA="#ede6d6",WA="#faf7f2",MI="#6b6258",BO="#d4c9b5";
const LANGS=["Swedish","English","Danish","Norwegian","Finnish","German","French","Spanish","Italian","Dutch","Portuguese","Polish","Russian","Greek","Turkish","Japanese","Chinese","Korean","Thai","Arabic","Hindi"];
const SS={padding:"7px 10px",border:"1px solid #d4c9b5",borderRadius:5,fontFamily:"Georgia,serif",fontSize:13,color:"#2a2a2a",background:"#f5f0e8",outline:"none",cursor:"pointer",width:"100%"};
const EXAMPLE=`Chocolate Chip Cookies (24 cookies)
350 degrees F, 10-12 minutes

2 1/4 cups flour
1 cup (2 sticks) butter, softened
3/4 cup granulated sugar
3/4 cup brown sugar
2 large eggs
1 tsp vanilla extract
1 tsp baking soda, 1 tsp salt
2 cups chocolate chips

Beat butter and sugars until fluffy. Add eggs and vanilla.
Mix in flour, baking soda, and salt. Stir in chips.
Drop by rounded tablespoon onto ungreased baking sheets.
Bake 9-11 minutes until golden brown. Cool on wire rack.`;

// â”€â”€ SVG Illustration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SumiIllustration() {
  return h("svg",{viewBox:"0 0 1200 260",xmlns:"http://www.w3.org/2000/svg",style:{width:"100%",height:"auto",display:"block"}},
    h("defs",null,
      h("filter",{id:"ink",x:"-10%",y:"-10%",width:"120%",height:"120%"},
        h("feTurbulence",{type:"fractalNoise",baseFrequency:"0.65",numOctaves:"3",seed:"2",result:"noise"}),
        h("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1.8",xChannelSelector:"R",yChannelSelector:"G",result:"displaced"}),
        h("feGaussianBlur",{in:"displaced",stdDeviation:"0.4"})
      ),
      h("filter",{id:"splat"},h("feGaussianBlur",{stdDeviation:"0.6"}))
    ),
    h("g",{filter:"url(#ink)"},
      h("path",{d:"M 95 245 C 94 220 92 195 90 168 C 89 150 90 135 92 118",stroke:"#2d4a3e",strokeWidth:"7",fill:"none",strokeLinecap:"round",opacity:"0.88"}),
      h("path",{d:"M 92 118 C 76 92 68 62 70 38 C 71 22 80 10 90 12 C 100 14 104 30 100 55 C 97 75 92 98 92 118",stroke:"#2d4a3e",strokeWidth:"3.2",fill:"none",strokeLinecap:"round",opacity:"0.85"}),
      h("path",{d:"M 92 118 C 82 88 78 58 82 36 C 85 20 93 10 101 14 C 108 18 109 35 105 60 C 102 80 95 100 92 118",stroke:"#2d4a3e",strokeWidth:"2.6",fill:"none",strokeLinecap:"round",opacity:"0.75"}),
      h("path",{d:"M 72 70 Q 96 75 118 68",stroke:"#2d4a3e",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",opacity:"0.3"})
    ),
    h("g",{filter:"url(#splat)",opacity:"0.18"},
      h("circle",{cx:"52",cy:"55",r:"5",fill:"#2d4a3e"}),
      h("circle",{cx:"138",cy:"42",r:"3.5",fill:"#2d4a3e"}),
      h("circle",{cx:"130",cy:"105",r:"2",fill:"#b85c38",opacity:"0.9"})
    ),
    h("g",{transform:"rotate(-8, 400, 140)",filter:"url(#ink)"},
      h("path",{d:"M 258 148 C 270 138 350 125 430 122 C 510 119 570 124 590 132 C 608 140 612 155 598 164 C 582 174 510 180 430 182 C 350 184 278 176 262 165 C 250 157 248 156 258 148 Z",fill:"#2d4a3e",fillOpacity:"0.08",stroke:"#2d4a3e",strokeWidth:"2.8",opacity:"0.6"}),
      h("path",{d:"M 258 148 C 244 144 228 146 220 154 C 214 162 218 172 230 174 C 242 176 256 168 262 165",stroke:"#2d4a3e",strokeWidth:"5.5",fill:"none",strokeLinecap:"round",opacity:"0.75"}),
      h("path",{d:"M 598 132 C 614 126 632 128 638 138 C 644 148 638 160 626 162 C 614 164 600 158 598 132",stroke:"#2d4a3e",strokeWidth:"5.5",fill:"none",strokeLinecap:"round",opacity:"0.75"})
    ),
    h("g",{transform:"translate(650, 18)",filter:"url(#ink)"},
      h("path",{d:"M 22 200 C 18 170 20 140 28 110 C 38 75 62 45 95 28 C 120 14 158 8 188 14 C 220 20 245 42 255 72 C 264 98 262 135 254 168 C 248 192 240 206 228 212 C 195 224 55 228 22 200 Z",fill:"#b85c38",fillOpacity:"0.14"}),
      h("path",{d:"M 22 200 C 18 170 20 140 28 110 C 38 75 62 45 95 28 C 120 14 158 8 188 14 C 220 20 245 42 255 72 C 264 98 262 135 254 168 C 248 192 240 206 228 212 C 195 224 55 228 22 200 Z",stroke:"#b85c38",strokeWidth:"4",fill:"none",strokeLinecap:"round",opacity:"0.72"}),
      h("path",{d:"M 72 28 C 80 55 80 100 76 148",stroke:"#2d4a3e",strokeWidth:"3",fill:"none",strokeLinecap:"round",opacity:"0.42"}),
      h("path",{d:"M 156 14 C 162 42 162 88 158 140",stroke:"#2d4a3e",strokeWidth:"2.6",fill:"none",strokeLinecap:"round",opacity:"0.35"})
    ),
    h("g",{opacity:"0.55"},
      h("path",{d:"M 598 195 C 590 175 582 152 578 132",stroke:"#2d4a3e",strokeWidth:"1.8",fill:"none",strokeLinecap:"round"}),
      h("path",{d:"M 590 168 C 578 162 570 155 566 145",stroke:"#2d4a3e",strokeWidth:"1.4",fill:"none",strokeLinecap:"round"}),
      h("ellipse",{cx:"572",cy:"150",rx:"6",ry:"3",fill:"#2d4a3e",opacity:"0.4",transform:"rotate(-30 572 150)"}),
      h("circle",{cx:"555",cy:"185",r:"2.5",fill:"#b85c38",opacity:"0.5"})
    ),
    h("g",{transform:"rotate(18, 1120, 130)",filter:"url(#ink)"},
      h("path",{d:"M 1148 252 C 1147 225 1145 195 1143 162 C 1141 138 1140 115 1141 95",stroke:"#2d4a3e",strokeWidth:"7.5",fill:"none",strokeLinecap:"round",opacity:"0.8"}),
      h("path",{d:"M 1141 95 C 1135 78 1125 60 1118 48 C 1110 35 1102 26 1100 22 C 1098 16 1102 10 1112 10 C 1122 10 1132 18 1138 30 C 1144 42 1148 60 1147 78 C 1146 88 1144 94 1141 95 Z",fill:"#2d4a3e",fillOpacity:"0.12",stroke:"#2d4a3e",strokeWidth:"3",strokeLinecap:"round",opacity:"0.7"})
    )
  );
}

// â”€â”€ LangBar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function LangBar({tab,tLang,setTLang,sLang,setSLang,mobile}){
  return h("div",{style:{display:"grid",gridTemplateColumns:mobile?"1fr":"1fr 1fr",gap:12,marginBottom:20}},
    h("div",null,
      h("label",{style:{display:"block",fontFamily:"sans-serif",fontSize:9,fontWeight:700,letterSpacing:"0.15em",textTransform:"uppercase",color:MI,marginBottom:5}},
        "Ã–versÃ¤tt till"
      ),
      h("select",{value:tLang,onChange:e=>setTLang(e.target.value),style:SS},
        LANGS.map(l=>h("option",{key:l,value:l},l))
      )
    ),
    tab!=="image" && h("div",null,
      h("label",{style:{display:"block",fontFamily:"sans-serif",fontSize:9,fontWeight:700,letterSpacing:"0.15em",textTransform:"uppercase",color:MI,marginBottom:5}},
        "OriginalsprÃ¥k"
      ),
      h("select",{value:sLang,onChange:e=>setSLang(e.target.value),style:SS},
        h("option",{value:"auto"},"Automatisk igenkÃ¤nning"),
        LANGS.map(l=>h("option",{key:l,value:l},l))
      )
    )
  );
}

// â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App(){
  const [tab,    setTab]    = useState("text");
  const [input,  setInput]  = useState(EXAMPLE);
  const [url,    setUrl]    = useState("");
  const [imgB64,  setImgB64]  = useState(null);
  const [imgMime, setImgMime] = useState("image/jpeg");
  const [imgSrc,  setImgSrc]  = useState(null);
  const [tLang,   setTLang]   = useState("Swedish");
  const [sLang,  setSLang]  = useState("auto");
  const [result, setResult] = useState(null);
  const [srcUrl, setSrcUrl] = useState(null);
  const [busy,   setBusy]   = useState(false);
  const [status, setStatus] = useState("");
  const [copied, setCopied] = useState(false);
  const [info,   setInfo]   = useState(false);
  const [winW,   setWinW]   = useState(window.innerWidth);
  const fileRef = useRef();

  useEffect(()=>{
    const h2=()=>setWinW(window.innerWidth);
    window.addEventListener("resize",h2);
    return ()=>window.removeEventListener("resize",h2);
  },[]);

  const mobile = winW<640;
  const medium = winW<860;

  function loadImg(file){
    if(!file||!file.type.startsWith("image/")){setStatus("Bara bildfiler (JPG, PNG, HEIC).");return;}
    if(file.size>20000000){setStatus("Max 20 MB.");return;}
    setStatus("FÃ¶rbereder bild...");
    const reader=new FileReader();
    reader.onload=function(e){
      const original=e.target.result;
      setImgSrc(original);
      const img=new Image();
      img.onload=function(){
        const MAX=1600;
        let w=img.width, h=img.height;
        if(w>MAX||h>MAX){const s=MAX/Math.max(w,h);w=Math.round(w*s);h=Math.round(h*s);}
        const canvas=document.createElement("canvas");
        canvas.width=w;canvas.height=h;
        canvas.getContext("2d").drawImage(img,0,0,w,h);
        const compressed=canvas.toDataURL("image/jpeg",0.85);
        const b64=compressed.split(",")[1];
        if(b64.length>3500000){setStatus("Bilden Ã¤r fÃ¶r stor Ã¤ven efter komprimering. FÃ¶rsÃ¶k med lÃ¤gre upplÃ¶sning.");return;}
        setImgB64(b64);
        setImgMime("image/jpeg");
        setStatus("");
      };
      img.onerror=function(){setStatus("Kunde inte lÃ¤sa bilden.");};
      img.src=original;
    };
    reader.readAsDataURL(file);
  }

  async function translate(){
    setStatus("");setResult(null);setBusy(true);
    try{
      let recipe;
      if(tab==="text"){
        if(!input.trim())throw new Error("Klistra in ett recept.");
        setStatus("Ã–versÃ¤tterâ€¦");
        recipe=await callBackend({type:"text",content:input,targetLanguage:tLang,sourceLanguage:sLang});
        setSrcUrl(null);
      }else if(tab==="url"){
        if(!url.trim())throw new Error("Ange en webbadress.");
        setStatus("HÃ¤mtar och Ã¶versÃ¤tterâ€¦");
        recipe=await callBackend({type:"url",url:url.trim(),targetLanguage:tLang});
        setSrcUrl(url.trim());
      }else{
        if(!imgB64)throw new Error("Ladda upp ett foto fÃ¶rst.");
        setStatus("LÃ¤ser fotoâ€¦");
        recipe=await callBackend({type:"image",image:imgB64,imageMime:imgMime,targetLanguage:tLang});
        setSrcUrl(null);
      }
      recipe._fetchedAt=new Date().toLocaleDateString("sv-SE");
      setResult(recipe);setStatus("");
    }catch(e){setStatus(e.message);}
    finally{setBusy(false);}
  }

  function doCopy(){
    if(!result)return;
    const text=buildPlainText(result,srcUrl);
    const ok=()=>{setCopied(true);setTimeout(()=>setCopied(false),2500);};
    if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(text).then(ok).catch(()=>fb(text,ok));}
    else fb(text,ok);
  }
  function fb(text,ok){
    const ta=document.createElement("textarea");ta.value=text;ta.style.cssText="position:fixed;opacity:0";
    document.body.appendChild(ta);ta.focus();ta.select();document.execCommand("copy");document.body.removeChild(ta);ok();
  }

  const m=result?.meta||{};
  const chips=[m.portioner,m.totaltid&&"Totalt: "+m.totaltid,m.svarighetsgrad].filter(Boolean);

  // â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return h("div",{style:{background:CR,minHeight:"100vh",paddingBottom:100}},

    // Header
    h("header",{style:{background:"#1c3028",borderBottom:"3px solid "+T}},
      h("div",{style:{background:PA,borderBottom:"1px solid "+BO,padding:"4px 0 0",overflow:"hidden"}},
        h(SumiIllustration,null)
      ),
      h("div",{style:{padding:mobile?"16px 18px 14px":"22px 36px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:8}},
        h("div",null,
          h("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8}},
            h("div",{style:{width:28,height:2,background:T,borderRadius:2}}),
            h("span",{style:{color:"rgba(237,230,214,0.45)",fontSize:9,letterSpacing:"0.22em",textTransform:"uppercase",fontFamily:"sans-serif"}},
              "Recept & KÃ¶ksÃ¶versÃ¤ttning"
            )
          ),
          h("h1",{style:{margin:0,lineHeight:1,fontFamily:"'Palatino Linotype','Georgia',serif",fontWeight:400}},
            h("span",{style:{fontSize:"clamp(28px,5.5vw,52px)",color:CR}},"Recept"),
            h("span",{style:{fontSize:"clamp(28px,5.5vw,52px)",color:G,fontStyle:"italic"}},"Ã¶versÃ¤ttaren")
          )
        ),
        h("button",{onClick:()=>setInfo(v=>!v),style:{background:"transparent",border:"1.5px solid rgba(201,168,76,0.4)",borderRadius:"50%",width:34,height:34,color:G,fontSize:16,fontWeight:700,cursor:"pointer",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Georgia,serif",fontStyle:"italic"}},"i")
      )
    ),

    // Info modal
    info && h("div",{onClick:()=>setInfo(false),style:{position:"fixed",inset:0,background:"rgba(20,30,26,0.55)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",padding:24}},
      h("div",{onClick:e=>e.stopPropagation(),style:{background:WA,borderRadius:10,border:"1px solid "+BO,maxWidth:520,width:"100%",boxShadow:"0 16px 48px rgba(0,0,0,0.25)",overflow:"hidden"}},
        h("div",{style:{background:PA,padding:"14px 22px",borderBottom:"1px solid "+BO,display:"flex",justifyContent:"space-between",alignItems:"center"}},
          h("span",{style:{fontFamily:"'Palatino Linotype','Georgia',serif",fontStyle:"italic",fontSize:16,color:F}},"Om ReceptÃ¶versÃ¤ttaren"),
          h("button",{onClick:()=>setInfo(false),style:{background:"transparent",border:"none",color:MI,fontSize:22,cursor:"pointer"}},"Ã—")
        ),
        h("div",{style:{padding:"22px 26px",fontFamily:"sans-serif",fontSize:13,color:MI,lineHeight:1.8}},
          h("p",{style:{margin:"0 0 14px"}},"Ã–versÃ¤tt recept pÃ¥ valfritt sprÃ¥k till valfritt mÃ¥lsprÃ¥k â€” med automatisk omvandling av mÃ¥tt till metriska enheter."),
          h("p",{style:{margin:"0 0 14px"}},"Tre sÃ¤tt: klistra in text, ange en webbadress, eller ladda upp ett foto frÃ¥n en kokbok eller ett handskrivet recept."),
          h("p",{style:{margin:0,fontSize:12,color:"#9a9088",borderTop:"1px solid "+BO,paddingTop:14}},"UpphovsrÃ¤tten tillhÃ¶r alltid originalkÃ¤llan.")
        )
      )
    ),

    // Main
    h("main",{style:{maxWidth:920,margin:"0 auto",padding:mobile?"20px 14px 0":"36px 24px 0"}},

      // Tabs
      h("div",{style:{display:"flex",borderBottom:"2px solid "+BO,marginBottom:20,overflowX:"auto"}},
        [["text","Klistra in text"],["url","Webbadress (URL)"],["image","Foto ðŸ“·"]].map(([t,l])=>
          h("button",{key:t,onClick:()=>{setTab(t);setStatus("");},style:{padding:mobile?"10px 14px":"11px 26px",border:"none",background:tab===t?PA:"transparent",fontFamily:"sans-serif",fontSize:mobile?10:11,fontWeight:tab===t?700:500,letterSpacing:"0.1em",textTransform:"uppercase",color:tab===t?F:MI,borderBottom:"2px solid "+(tab===t?F:"transparent"),marginBottom:-2,cursor:"pointer",borderRadius:"4px 4px 0 0",whiteSpace:"nowrap",flexShrink:0}},l)
        )
      ),

      // Grid
      h("div",{style:{display:"grid",gridTemplateColumns:medium?"1fr":"1fr 236px",gap:mobile?16:24}},

        // Left column
        h("div",null,
          h(LangBar,{tab,tLang,setTLang,sLang,setSLang,mobile}),

          // Text tab
          tab==="text" && h("div",{style:{background:WA,borderRadius:8,border:"1px solid "+BO,boxShadow:"0 1px 8px rgba(45,74,62,0.06)",overflow:"hidden"}},
            h("div",{style:{background:PA,padding:"9px 18px",borderBottom:"1px solid "+BO,display:"flex",justifyContent:"space-between",alignItems:"center"}},
              h("span",{style:{fontFamily:"sans-serif",fontSize:9,fontWeight:700,letterSpacing:"0.15em",textTransform:"uppercase",color:MI}},"Originalrecept â€” valfritt sprÃ¥k"),
              h("button",{onClick:()=>setInput(""),style:{background:"transparent",border:"none",color:MI,fontSize:11,cursor:"pointer",fontFamily:"sans-serif"}},"Rensa")
            ),
            h("textarea",{value:input,onChange:e=>setInput(e.target.value),style:{width:"100%",minHeight:mobile?200:290,padding:"16px 20px",border:"none",background:"transparent",fontFamily:"Georgia,serif",fontSize:13,lineHeight:1.85,resize:"vertical",outline:"none",color:"#6b6258",fontStyle:"italic",boxSizing:"border-box"}})
          ),

          // URL tab
          tab==="url" && h("div",{style:{background:WA,borderRadius:8,border:"1px solid "+BO,padding:24,boxShadow:"0 1px 8px rgba(45,74,62,0.06)"}},
            h("label",{style:{display:"block",fontFamily:"sans-serif",fontSize:9,fontWeight:700,letterSpacing:"0.15em",textTransform:"uppercase",color:MI,marginBottom:10}},"Receptets webbadress"),
            h("input",{type:"text",value:url,onChange:e=>setUrl(e.target.value),placeholder:"https://www.allrecipes.com/recipe/...",style:{width:"100%",padding:"12px 14px",border:"1px solid "+BO,borderRadius:6,fontFamily:"Georgia,serif",fontSize:13,outline:"none",color:"#2a2a2a",marginBottom:18,boxSizing:"border-box",background:CR}}),
            h("div",{style:{borderTop:"1px solid "+BO,paddingTop:16,fontFamily:"sans-serif",fontSize:12,color:MI,lineHeight:1.8}},
              h("div",{style:{fontWeight:700,color:F,marginBottom:4,fontSize:11}},"Fungerar med:"),
              "AllRecipes Â· Food Network Â· NYT Cooking",h("br",null),"Serious Eats Â· Epicurious Â· BBC Good Food"
            )
          ),

          // Image tab
          tab==="image" && h("div",null,
            h("input",{ref:fileRef,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>loadImg(e.target.files[0])}),
            h("div",{
              onClick:()=>fileRef.current.click(),
              onDragOver:e=>e.preventDefault(),
              onDrop:e=>{e.preventDefault();loadImg(e.dataTransfer.files[0]);},
              style:{background:WA,borderRadius:8,border:"2px dashed "+BO,padding:mobile?24:36,textAlign:"center",cursor:"pointer",boxShadow:"0 1px 8px rgba(45,74,62,0.06)"}
            },
              imgSrc
                ? h("div",null,
                    h("img",{src:imgSrc,alt:"Bild",style:{maxWidth:"100%",maxHeight:260,borderRadius:6,border:"1px solid "+BO}}),
                    h("div",{style:{marginTop:12,fontFamily:"sans-serif",fontSize:11,color:MI}},"Klicka fÃ¶r att byta bild")
                  )
                : h("div",null,
                    h("div",{style:{fontSize:mobile?36:48,marginBottom:12}},"ðŸ“·"),
                    h("div",{style:{fontFamily:"'Palatino Linotype','Georgia',serif",fontStyle:"italic",fontSize:mobile?15:18,color:F,marginBottom:8}},"Ladda upp ett foto av receptet"),
                    h("div",{style:{fontFamily:"sans-serif",fontSize:12,color:MI,lineHeight:1.7}},"Dra och slÃ¤pp, eller klicka fÃ¶r att vÃ¤lja"),
                    h("div",{style:{marginTop:16,fontFamily:"sans-serif",fontSize:11,color:BO}},"JPG Â· PNG Â· HEIC Â· Max 8 MB")
                  )
            ),
            h("div",{style:{marginTop:14,background:PA,borderRadius:6,padding:"12px 16px",fontFamily:"sans-serif",fontSize:12,color:MI,lineHeight:1.7,border:"1px solid "+BO}},
              h("strong",{style:{color:F}},"Tips: "),
              "Fungerar med kokbokssidor, handskrivna recept och restaurangmenyer â€” pÃ¥ vilket sprÃ¥k som helst."
            )
          )
        ),

        // Sidebar
        h("div",{style:{display:"flex",flexDirection:"column",gap:16}},
          !mobile && h("div",{style:{background:WA,borderRadius:8,border:"1px solid "+BO,padding:"16px 18px",boxShadow:"0 1px 8px rgba(45,74,62,0.06)"}},
            h("div",{style:{fontFamily:"'Palatino Linotype','Georgia',serif",fontStyle:"italic",color:F,fontSize:15,marginBottom:12,paddingBottom:10,borderBottom:"1px solid "+BO}},"Konverteras"),
            h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"7px 12px"}},
              [["cups","dl"],["oz","g"],["sticks","g"],["lbs","kg"],["Â°F","Â°C"],["tbsp","msk"],["tsp","tsk"],["pint","dl"],["inch","cm"],["gallon","L"]].map(([a,b])=>
                h("div",{key:a,style:{display:"flex",alignItems:"center",gap:5,fontFamily:"Georgia,serif",fontSize:12,color:MI}},
                  h("span",{style:{color:T}},a),
                  h("span",{style:{color:BO,fontSize:8}},"â–¶"),
                  h("span",{style:{color:F}},b)
                )
              )
            )
          ),
          h("button",{onClick:translate,disabled:busy,style:{background:busy?"#7e9e96":F,color:CR,border:"none",borderRadius:6,padding:"15px 12px",fontFamily:"sans-serif",fontSize:12,fontWeight:700,letterSpacing:"0.14em",textTransform:"uppercase",cursor:busy?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:10,boxShadow:busy?"none":"0 4px 16px rgba(45,74,62,0.3)"}},
            busy
              ? [h("span",{key:"s",style:{width:14,height:14,border:"2px solid rgba(237,230,214,0.3)",borderTopColor:CR,borderRadius:"50%",display:"inline-block",animation:"spin .7s linear infinite",flexShrink:0,boxSizing:"content-box"}}),status]
              : tab==="image" ? "ðŸ“· LÃ¤s och Ã¶versÃ¤tt" : "Ã–versÃ¤tt recept"
          ),
          status&&!busy && h("div",{style:{background:"#fdf0ed",borderLeft:"3px solid "+T,borderRadius:"0 6px 6px 0",padding:"12px 14px",fontFamily:"sans-serif",fontSize:12,color:T,lineHeight:1.65}},status)
        )
      ),

      // Result
      result && h("div",{style:{marginTop:48,background:WA,borderRadius:8,border:"1px solid "+BO,boxShadow:"0 4px 28px rgba(45,74,62,0.09)",overflow:"hidden"}},
        h("div",{style:{background:PA,padding:"12px 24px",borderBottom:"1px solid "+BO,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:10}},
          h("span",{style:{fontFamily:"'Palatino Linotype','Georgia',serif",fontStyle:"italic",color:F,fontSize:14}},"Ã–versatt recept â€” "+tLang),
          h("div",{style:{display:"flex",gap:10,flexWrap:"wrap"}},
            h("button",{onClick:doCopy,style:{padding:"8px 18px",borderRadius:5,border:"1.5px solid "+F,background:copied?F:"transparent",color:copied?CR:F,fontFamily:"sans-serif",fontSize:10,fontWeight:700,letterSpacing:"0.1em",textTransform:"uppercase",cursor:"pointer"}},copied?"âœ“ Kopierat":"Kopiera text"),
            h("button",{onClick:()=>generatePDF(result),style:{padding:"8px 18px",borderRadius:5,border:"none",background:T,color:"#fff",fontFamily:"sans-serif",fontSize:10,fontWeight:700,letterSpacing:"0.1em",textTransform:"uppercase",cursor:"pointer",boxShadow:"0 2px 10px rgba(184,92,56,0.35)"}},"Ladda ner PDF")
          )
        ),
        h("div",{style:{padding:mobile?"24px 18px":"40px 48px"}},
          h("div",{style:{display:"flex",alignItems:"flex-start",gap:16,marginBottom:6}},
            h("div",{style:{width:4,minHeight:52,background:T,borderRadius:2,flexShrink:0,marginTop:4}}),
            h("h2",{style:{margin:0,fontFamily:"'Palatino Linotype','Georgia',serif",fontSize:"clamp(24px,4vw,36px)",fontWeight:400,color:F,lineHeight:1.1}},result.titel)
          ),
          result.beskrivning && h("div",{style:{marginLeft:20,marginBottom:24,fontFamily:"Georgia,serif",fontSize:14,color:MI,lineHeight:1.8,fontStyle:"italic",borderLeft:"2px solid "+G,paddingLeft:16}},result.beskrivning),
          chips.length>0 && h("div",{style:{display:"inline-flex",flexWrap:"wrap",border:"1px solid "+BO,borderRadius:6,overflow:"hidden",marginBottom:32}},
            chips.map((c,i)=>h("div",{key:i,style:{padding:"9px 20px",fontFamily:"sans-serif",fontSize:11,color:F,fontWeight:600,background:i%2===0?PA:WA,borderRight:i<chips.length-1?"1px solid "+BO:"none"}},c))
          ),

          h("div",{style:{display:"flex",alignItems:"center",gap:14,margin:"0 0 18px"}},
            h("span",{style:{fontFamily:"'Palatino Linotype','Georgia',serif",fontStyle:"italic",fontSize:20,color:T,whiteSpace:"nowrap"}},"Ingredienser"),
            h("div",{style:{flex:1,height:1,background:BO}})
          ),
          h("ul",{style:{listStyle:"none",padding:0,margin:"0 0 12px"}},
            (result.ingredienser||[]).map((ing,i)=>{
              const grp=ing.grupp||"",prev=result.ingredienser[i-1];
              const newG=grp&&(!prev||(prev.grupp||"")!==grp);
              return newG
                ? h("li",{key:"g"+i,style:{padding:"14px 0 4px",fontFamily:"sans-serif",fontSize:9,fontWeight:700,letterSpacing:"0.18em",textTransform:"uppercase",color:T,borderTop:"1px solid "+BO}},grp)
                : h("li",{key:i,style:{display:"grid",gridTemplateColumns:mobile?"90px 1fr":"116px 1fr",padding:"8px 0",fontFamily:"sans-serif",fontSize:mobile?12:13,borderBottom:"1px dotted "+BO,alignItems:"baseline",gap:8}},
                    h("span",{style:{fontWeight:700,color:F}},ing.mangd||""),
                    h("span",{style:{color:"#2a2a2a"}},ing.ingrediens)
                  );
            })
          ),

          h("div",{style:{display:"flex",alignItems:"center",gap:14,margin:"32px 0 18px"}},
            h("span",{style:{fontFamily:"'Palatino Linotype','Georgia',serif",fontStyle:"italic",fontSize:20,color:T,whiteSpace:"nowrap"}},"GÃ¶r sÃ¥ hÃ¤r"),
            h("div",{style:{flex:1,height:1,background:BO}})
          ),
          h("ol",{style:{listStyle:"none",padding:0,margin:0}},
            (result.steg||[]).map((s,i)=>
              h("li",{key:i,style:{display:"flex",gap:mobile?12:18,marginBottom:18,fontFamily:"sans-serif",fontSize:mobile?12:13,lineHeight:1.85}},
                h("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:30,height:30,background:F,color:CR,borderRadius:"50%",fontSize:12,fontWeight:700,flexShrink:0,marginTop:1}},i+1),
                h("span",{style:{paddingTop:5,color:"#2a2a2a"}},s)
              )
            )
          ),

          result.noteringar && h("div",null,
            h("div",{style:{display:"flex",alignItems:"center",gap:14,margin:"32px 0 16px"}},
              h("span",{style:{fontFamily:"'Palatino Linotype','Georgia',serif",fontStyle:"italic",fontSize:18,color:MI,whiteSpace:"nowrap"}},"Tips & noteringar"),
              h("div",{style:{flex:1,height:1,background:BO}})
            ),
            h("div",{style:{background:PA,borderLeft:"3px solid "+G,padding:"18px 22px",borderRadius:"0 6px 6px 0",fontFamily:"Georgia,serif",fontSize:13,color:MI,lineHeight:1.8,fontStyle:"italic"}},result.noteringar)
          ),

          (srcUrl||result._fetchedAt) && h("div",{style:{marginTop:32,paddingTop:14,borderTop:"1px dotted "+BO,fontFamily:"sans-serif",fontSize:11,color:"#aaa098",lineHeight:1.7}},
            h("span",{style:{fontWeight:600,letterSpacing:"0.05em"}},"KÃ¤lla: "),
            srcUrl && h("a",{href:srcUrl,target:"_blank",rel:"noopener",style:{color:"#aaa098",textDecoration:"underline"}},srcUrl),
            result._fetchedAt && h("span",null," Â· "+result._fetchedAt)
          )
        )
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body>
</html>
